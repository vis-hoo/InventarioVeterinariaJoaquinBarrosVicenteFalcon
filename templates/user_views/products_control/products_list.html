{% extends "base_general.html" %}
{% load static %}

{% block titulo %}Listado de productos{% endblock %}
{% block sidebar %}

{% if user.is_superuser %}
    {% include 'user_views/super_user/sidebar.html' %}
{% else %}
    {% include 'user_views/regular_user/sidebar.html' %}
{% endif %}

{% endblock %}
{% block topbar %} {% include 'menu/topbar_user_name.html' %} {% endblock %}
{% block content %}

<link rel="stylesheet" href="https://cdn.datatables.net/2.3.4/css/dataTables.dataTables.css" />

<div class="container">
    <div class="alert alert-info display-3 text-center my-5"
        style="background-color: var(--primary) !important; color: white; border: none;">
        Listado de productos
    </div>
</div>
<table id="productsTable" class="table">
    <thead>
        <tr>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Precio</th>
            <th>Categoría</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% if productos %} {% for prod in productos %} {% if user.is_superuser or prod.creador == user %}

        <tr>
            <td>{{prod.nombre}}</td>
            <td>{{prod.descripcion}}</td>
            <td>{{prod.precio}}</td>
            <td>{{prod.categoria}}</td>
            <td>
                <!-- Editar -->
                <a href="{% url 'products_edit' prod.id %}" class="btn btn-sm btn-secondary">
                    <i class="bi bi-pencil"></i>
                </a>

                {% if user.is_superuser %}
                    <!-- Eliminar (desactivar)-->
                    <button class="btn btn-sm btn-secondary" data-bs-toggle="modal"
                        data-bs-target="#modalDelete{{ prod.id }}">
                        <i class="bi bi-trash"></i>
                    </button>
                {% endif %}
            </td>
        </tr>

        <!-- Modal para confirmar eliminación del producto -->
        <div class="modal fade" id="modalDelete{{ prod.id }}" tabindex="-1"
            aria-labelledby="modalLabel{{ prod.id }}" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="modalLabel{{ prod.id }}">Confirmar eliminación</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>

                    <div class="modal-body">
                        ¿Estás seguro que deseas eliminar el producto <strong>{{ prod.nombre }}</strong>?
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                        <a href="{% url 'products_delete' prod.id %}" class="btn btn-danger">Eliminar</a>
                    </div>

                </div>
            </div>
        </div>
        {% endif %}{% endfor %}{% endif %}
    </tbody>
</table>

<style>
    .btn-primary {
        background-color: var(--primary);
        color: white;
        border-color: white;
    }

    .btn-primary:hover {
        color: var(--primary);
        background-color: white;
        border-color: var(--primary);
    }

    .a {
        color: var(--primary);
    }

    .a:hover {
        color: var(--primary) !important;
    }
</style>
{% endblock %}
{% block scriptsTablas %}
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/2.3.4/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.3.4/js/dataTables.bootstrap5.js"></script>
<script src="https://cdn.datatables.net/buttons/3.2.5/js/dataTables.buttons.js"></script>
<script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.bootstrap5.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/3.2.5/js/buttons.colVis.min.js"></script>

<script>
    new DataTable("#productsTable", {
        layout: {
            topStart: {
                buttons: ["excel", "pdf"],
            },
            topEnd: 'search',
            bottomStart: null,
            bottomEnd: null
        },
        language: {
            url: "https://cdn.datatables.net/plug-ins/2.3.4/i18n/es-ES.json",
        },
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>
{% endblock %}
{% block footer %} {% include 'menu/footer.html' %} {% endblock %}
{% block extras %} {% include 'menu/logout_dialog.html' %} {% endblock %}